<!--
    Slack検索：検索画面
-->
<!DOCTYPE html>
<html lang="ja">
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
<head>
    <meta charset="UTF-8">
    <title>Slack Search</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/slack_app.css') }}" type="text/css">

    <script>
        // 検索
        function doSearch() {
            $('#poster_list').val(getCheckTarget('poster').join(','));
            $('#public_channel_list').val(getCheckTarget('public_channel').join(','));
            $('#private_channel_list').val(getCheckTarget('private_channel').join(','));
            $('#im_channel_list').val(getCheckTarget('im_channel').join(','));

            $('#form').submit()
        }

        // チェックONのリストを取得
        function getCheckTarget(targetName) {
            return Array.from(
                document.querySelectorAll('input[type="checkbox"][name="' + targetName + '"]:checked')
            ).map(cb => cb.value);
        }

        $(function(){
            $('#search').click(function() {
                doSearch();
            });

            $('#poster_all_sel').click(function() {
                $('input[name^="poster_list"]').prop('checked', true);
                return false;
            });

            $('#poster_all_desel').click(function() {
                $('input[name^="poster_list"]').prop('checked', false);
                return false;
            });

            $('#public_channel_all_sel').click(function() {
                $('input[name^="public_channel_list"]').prop('checked', true);
                return false;
            });

            $('#public_channel_all_desel').click(function() {
                $('input[name^="public_channel_list"]').prop('checked', false);
                return false;
            });

            $('#private_channel_all_sel').click(function() {
                $('input[name^="private_channel_list"]').prop('checked', true);
                return false;
            });

            $('#private_channel_all_desel').click(function() {
                $('input[name^="private_channel_list"]').prop('checked', false);
                return false;
            });

            $('#im_channel_all_sel').click(function() {
                $('input[name^="im_channel_list"]').prop('checked', true);
                return false;
            });

            $('#im_channel_all_desel').click(function() {
                $('input[name^="im_channel_list"]').prop('checked', false);
                return false;
            });
        });

    </script>
</head>
<body>
    <form id="form" name="form" action="/search" method="POST" target="_blank">
        {{ form.hidden_tag() }}
        <h1>Slack検索</h1>
        <table border="1">
            <tr>
                <th width="150px">
                    {{ form.search_val.label }}
                </th>
                <td>
                    {{ form.search_val }}

                    {% for search_type in form.search_type %}
                        {{ search_type }}
                        {{ search_type.label }}
                    {% endfor %}
                    &nbsp;&nbsp;
                    {{ form.is_contains_reply }}
                    {{ form.is_contains_reply.label }}
                </td>
            </tr>
            <tr>
                <th>
                    {{ form.search_from_date.label }}
                </th>
                <td>
                    {{ form.search_from_date }}
                    ～
                    {{ form.search_to_date }}
                </td>
            </tr>
            <tr>
                <th>
                    投稿者/返信者
                    <button id="poster_all_sel">全選択</button>
                    <button id="poster_all_desel">全解除</button>
                </th>
                <td>
                    <div class="checkbox-grid">
                        {% for poster in form.poster_list %}
                            <div class="checkbox-item">
                                <label class="checkbox-label">
                                    {{ poster.checked(value=poster.item_id.data) }} <span>{{ poster.label.data }}</span>
                                    {{ poster.item_id() }}
                                </label>
                            </div>
                        {% endfor %}
                    </div>
                </td>
            </tr>
            <tr>
                <th>
                    channel(public)
                    <button id="public_channel_all_sel">全選択</button>
                    <button id="public_channel_all_desel">全解除</button>
                </th>
                <td>
                    <div class="checkbox-grid">
                        {% for channel in form.public_channel_list %}
                            <div class="checkbox-item">
                                <label class="checkbox-label">
                                    {{ channel.checked(value=channel.item_id.data) }} <span>{{ channel.label.data }}</span>
                                    {{ channel.item_id() }}
                                </label>
                            </div>
                        {% endfor %}
                    </div>
                </td>
            </tr>
            <tr>
                <th>
                    channel(private)
                    <button id="private_channel_all_sel">全選択</button>
                    <button id="private_channel_all_desel">全解除</button>
                </th>
                <td>
                    <div class="checkbox-grid">
                        {% for channel in form.private_channel_list %}
                            <div class="checkbox-item">
                                <label class="checkbox-label">
                                    {{ channel.checked(value=channel.item_id.data) }} <span>{{ channel.label.data }}</span>
                                    {{ channel.item_id() }}
                                </label>
                            </div>
                        {% endfor %}
                    </div>
                </td>
            </tr>
            <tr>
                <th>
                    channel(im)
                    <button id="im_channel_all_sel">全選択</button>
                    <button id="im_channel_all_desel">全解除</button>
                </th>
                <td>
                    <div class="checkbox-grid">
                        {% for channel in form.im_channel_list %}
                            <div class="checkbox-item">
                                <label class="checkbox-label">
                                    {{ channel.checked(value=channel.item_id.data) }} <span>{{ channel.label.data }}</span>
                                    {{ channel.item_id() }}
                                </label>
                            </div>
                        {% endfor %}
                    </div>
                </td>
            </tr>
        </table>
        <br>
        <table>
            <tr>
                <td>
                    <button id="search" style="width: 7em; height : 3em">検索</button>
                </td>
            </tr>
        </table>
        <br>
    </form>
</body>
</html>